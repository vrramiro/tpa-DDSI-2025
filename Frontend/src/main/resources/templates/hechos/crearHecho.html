<html th:replace="~{layout/base::html}">
<head>
    <!-- CSS específico de esta vista -->
    <th:block th:fragment="styles">
        <link th:href="@{/css/hechos/crearHecho.css}" rel="stylesheet">
        <link rel="stylesheet" th:href="@{/webjars/leaflet/dist/leaflet.css}">
    </th:block>
</head>

<main th:fragment="contenido" class="container">
    <section class="form-container">
        <h1>Crear Hecho</h1>

        <form id="formCrearHecho" th:action="@{/hechos/crear}" th:object="${hecho}" method="POST" enctype="multipart/form-data" class="form">
            <div>
                <label for="titulo">Título</label>
                <input type="text" id="titulo" th:field="*{titulo}"
                       th:placeholder="${#fields.hasErrors('titulo') ? #fields.errors('titulo')[0] : 'Ingrese el título del hecho'}"
                       th:classappend="${#fields.hasErrors('titulo')} ? 'input-error' : ''">
            </div>

            <div>
                <label for="fecha" style="cursor: pointer;">
                    Fecha de acontecimiento
                    <span th:if="${#fields.hasErrors('fechaAcontecimiento')}"
                          th:text="${#fields.errors('fechaAcontecimiento')[0]}"
                          class="error-mensaje-label">
    </span>
                </label>
                <input type="date" id="fecha" th:field="*{fechaAcontecimiento}"
                       th:classappend="${#fields.hasErrors('fechaAcontecimiento')} ? 'input-error' : ''"
                       onclick="this.showPicker ? this.showPicker() : this.focus()">
            </div>

            <div>
                <label for="categoria">
                    Categoría
                    <span th:if="${#fields.hasErrors('idCategoria')}"
                          th:text="${#fields.errors('idCategoria')[0]}"
                          class="error-mensaje-label">
                    </span>
                </label>

                <select id="categoria" th:field="*{idCategoria}"
                        th:classappend="${#fields.hasErrors('idCategoria')} ? 'input-error' : ''">
                    <option value="">Seleccione una categoría</option>
                    <option th:each="cat : ${categorias}"
                            th:value="${cat.id}"
                            th:text="${cat.categoria}">
                    </option>
                </select>
            </div>

            <div>
                <label for="descripcion">Descripción</label>
                <textarea id="descripcion" th:field="*{descripcion}" rows="4"
                          th:placeholder="${#fields.hasErrors('descripcion') ? #fields.errors('descripcion')[0] : 'Escriba una descripción del hecho'}"
                          th:classappend="${#fields.hasErrors('descripcion')} ? 'input-error' : ''"></textarea>
            </div>

            <div class="form-group">
                <label class="form-label">Multimedia (Máx 5)</label>

                <div class="upload-area">
                    <input type="file" id="fileInput" accept="image/*,video/*" multiple hidden>
                    <label for="fileInput" class="btn btn-secondary btn-upload">
                        <span>+ Agregar archivos</span>
                    </label>
                    <span id="upload-counter" class="ms-2 text-muted">0/5</span>
                </div>

                <div id="preview-container" class="preview-grid mt-3"></div>

                <div id="hidden-inputs"></div>
            </div>

            <div>
                <label>Ubicación
                    <span th:if="${#fields.hasErrors('latitud') or #fields.hasErrors('longitud')}"
                          th:text="${#fields.hasErrors('latitud') ? #fields.errors('latitud')[0] : #fields.errors('longitud')[0]}"
                          class="error-mensaje-label">
                    </span>
                </label>
                <div class="map-placeholder" id="map"></div>
                <input type="hidden" id="latitud" th:field="*{latitud}">
                <input type="hidden" id="longitud" th:field="*{longitud}">
            </div>


            <div class="form-options">
                <label class="anonimo-option">
                    <span>Publicar como anónimo</span>
                    <input type="checkbox" id="anonimo" th:field="*{anonimo}">
                </label>
            </div>

            <div class="submit-container">
                <button type="submit" class="btn btn-primary" onclick="console.log('Botón clickeado')">Crear</button>
            </div>
        </form>
    </section>

    <div th:if="${mensaje}"
         class="modal-overlay"
         id="mensajeModal"
         th:attr="data-redirect=${tipoMensaje == 'success' ? 'true' : 'false'}">
        <div class="modal-content" th:classappend="${tipoMensaje == 'success' ? 'modal-success' : 'modal-error'}">
            <div class="modal-header">
                <h3 th:text="${tipoMensaje == 'success' ? '✓ Éxito' : '✗ Error'}"></h3>
            </div>
            <div class="modal-body">
                <p th:text="${mensaje}"></p>
            </div>
            <div class="modal-footer">
                <button type="button" onclick="cerrarModal()" class="btn btn-secondary">Cerrar</button>
            </div>
        </div>
    </div>

</main>

<th:block th:fragment="scripts">
    <script th:src="@{/webjars/leaflet/dist/leaflet.js}"></script>
    <script th:src="@{/js/hechos/crearHecho.js}"></script>
</th:block>
</html>