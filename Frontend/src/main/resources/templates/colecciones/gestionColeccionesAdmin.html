<html xmlns:th="http://www.thymeleaf.org" th:replace="~{layout/base::html}">
<head>
    <th:block th:fragment="styles">
        <link th:href="@{/css/colecciones/coleccionesSistema.css}" rel="stylesheet">
        <link th:href="@{/css/colecciones/gestionColecciones.css}" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    </th:block>
</head>

<div th:fragment="contenido" class="row">

    <span id="flash-data"
          hidden
          th:attr="data-mensaje=${mensaje}, data-tipo=${tipoMensaje}"></span>

    <main class="content-container">
        <div class="collection-header">
            <h2>Gestión de Colecciones</h2>
            <a th:href="@{/colecciones/nuevo}" class="btn btn-primary">
                <i class="fa-solid fa-plus"></i> Nueva Colección
            </a>
        </div>

        <div class="table-container">
            <table class="tabla-colecciones">
                <thead>
                <tr>
                    <th>Título</th>
                    <th>Descripción</th>
                    <th class="text-end">Acciones</th>
                </tr>
                </thead>

                <tbody>
                <tr th:if="${colecciones == null or #lists.isEmpty(colecciones)}">
                    <td colspan="3" class="muted text-center" style="padding: 2rem;">
                        No hay colecciones creadas todavía.
                    </td>
                </tr>

                <tr th:each="col : ${colecciones}">
                    <td th:text="${col.titulo ?: 'Sin título'}" style="font-weight: 500;">Sin título</td>

                    <td th:text="${col.descripcion}" class="desc-cell"></td>

                    <td class="action-buttons">
                        <a class="icon-btn btn-view"
                           th:href="@{/colecciones/{handle}/hechos(handle=${col.handle})}"
                           title="Ver hechos">
                            <i class="fa-solid fa-eye"></i>
                        </a>

                        <a class="icon-btn btn-edit"
                           th:href="@{/colecciones/{handle}/modificar(handle=${col.handle})}"
                           title="Editar configuración">
                            <i class="fa-solid fa-pen"></i>
                        </a>

                        <button type="button"
                                class="icon-btn btn-delete"
                                th:data-id="${col.handle}"
                                th:data-titulo="${col.titulo}"
                                onclick="abrirModalEliminarColeccion(this)"
                                title="Eliminar colección">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <div class="pagination-wrapper" th:if="${totalPages > 1}">
            <div th:replace="~{navegacion/navegacion :: pager(
                ${page},
                ${totalPages},
                ${size},
                ${baseUrl},
                ${filtro},
                ${sort},
                ${isFirst},
                ${isLast}
            )}"></div>
        </div>

        <div class="footer-actions">
            <a th:href="@{/panel_gestion}" class="btn btn-secondary">Volver al Panel</a>
        </div>

        <form id="form-eliminar-coleccion" method="post" hidden>
            <input th:if="${_csrf != null}" type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        </form>

        <div id="modal-eliminar" class="modal" hidden aria-modal="true" role="dialog">
            <div class="modal-content">
                <h3>Confirmar eliminación</h3>
                <p id="modal-eliminar-texto">¿Eliminar esta colección?</p>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="modal-eliminar-cancelar">Cancelar</button>
                    <button type="button" class="btn btn-delete" id="modal-eliminar-confirmar">Sí, eliminar</button>
                </div>
            </div>
        </div>

    </main>

    <th:block th:fragment="scripts">
        <script th:src="@{/js/colecciones/gestionColecciones.js}"></script>
        <script th:src="@{/js/colecciones/notificacion.js}"></script>
    </th:block>
</div>
</html>