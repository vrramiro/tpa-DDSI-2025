<html th:replace="~{layout/base:: html}">
<head>
  <th:block th:fragment="styles">
    <link th:href="@{/css/solicitudes/panelSolicitudAdmin.css}" rel="stylesheet">
  </th:block>
</head>

<div th:fragment="contenido" class="row">
  <div class="container">
    <h1>Detalle de Solicitud</h1>

    <div th:if="${mensaje}" class="alert alert-success mt-2" th:text="${mensaje}"></div>
    <div th:if="${error}" class="alert alert-danger mt-2" th:text="${error}"></div>

    <div class="grid-detalle">
      <section class="card">
        <h2>Solicitud #<span th:text="${solicitud.idSolicitud}"></span></h2>

        <p><strong>Autor de la solicitud:</strong>
          <span th:text="${solicitud.autor}">Juan Pérez</span>
        </p>
        <p><strong>Fecha:</strong>
          <span th:text="${#temporals.format(solicitud.fechaDeCreacion, 'dd/MM/yyyy HH:mm')}">Fecha</span>
        </p>
        <p><strong>Estado Actual:</strong>
          <span class="badge"
                th:classappend="${solicitud.estadoDeSolicitud == 'PENDIENTE' ? 'bg-warning' : (solicitud.estadoDeSolicitud == 'ACEPTADA' ? 'bg-success' : 'bg-danger')}"
                th:text="${solicitud.estadoDeSolicitud}">PENDIENTE</span>
        </p>

        <h3>Motivo</h3>
        <div class="textarea" th:text="${solicitud.descripcion}"></div>

        <div class="actions mt-3" th:if="${solicitud.estadoDeSolicitud == 'PENDIENTE'}">

          <form th:action="@{/solicitudes/procesar}" method="post" style="display:inline;"
                onsubmit="return confirm('¿Confirmás ACEPTAR la solicitud? Esto eliminará el hecho permanentemente.');">
            <input type="hidden" name="solicitudId" th:value="${solicitud.idSolicitud}" />
            <input type="hidden" name="estado" value="ACEPTADA" />
            <button type="submit" class="btn btn-success">Aceptar y Eliminar Hecho</button>
          </form>

          <form th:action="@{/solicitudes/procesar}" method="post" style="display:inline;"
                onsubmit="return confirm('¿Confirmás RECHAZAR la solicitud? El hecho permanecerá visible.');">
            <input type="hidden" name="solicitudId" th:value="${solicitud.idSolicitud}" />
            <input type="hidden" name="estado" value="RECHAZADA" />
            <button type="submit" class="btn btn-danger">Rechazar</button>
          </form>
        </div>

      </section>


      <section class="card" th:if="${hecho != null}">
        <h2 th:text="'Hecho Reportado: ' + ${hecho.titulo}">Hecho</h2>
        <p><strong>Autor del Hecho:</strong> <span th:text="${hecho.autor}">Autor</span></p>

        <p class="text-muted" th:if="${hecho.autor == null}">
          <em>(Autor desconocido o usuario eliminado)</em>
        </p>

        <h3>Descripción del Hecho</h3>
        <div class="textarea" th:text="${hecho.descripcion}"></div>

        <div th:if="${hecho.contenidoMultimedia != null and !hecho.contenidoMultimedia.isEmpty()}">
          <h3>Evidencia Multimedia</h3>
          <div th:each="media : ${hecho.contenidoMultimedia}">
            <img class="card-img"
                 th:if="${media.url != null}"
                 th:src="${media.url}"
                 alt="Multimedia del hecho"
                 style="max-width: 100%; margin-bottom: 10px;">
          </div>
        </div>
      </section>
    </div>

    <section class="volver">
    <div class="mt-3">
      <a th:href="@{/solicitudes/gestion}" class="btn btn-volver2">Volver al listado</a>
    </div>
    </section>

  </div>

  <th:block th:fragment="scripts">
    <script th:src="@{/js/solicitudes/panelSolicitudAdmin.js}"></script>
  </th:block>
</div>
</html>